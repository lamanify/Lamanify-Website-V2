---
import Layout from '../../layouts/Layout.astro';
import { CldUploadWidget } from 'astro-cloudinary';
---

<Layout title="Upload Assets">
  <main class="min-h-screen flex items-center justify-center bg-slate-50 p-4">
    <div class="w-full max-w-md bg-white rounded-2xl shadow-xl p-8 text-center">
      <div class="mb-6">
        <div class="h-16 w-16 bg-brand/10 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-brand" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
          </svg>
        </div>
        <h1 class="text-2xl font-bold text-slate-900 mb-2">Upload Image</h1>
        <p class="text-slate-600">Upload assets to Cloudinary for use in blog posts and pages.</p>
      </div>
      
      <CldUploadWidget 
        uploadPreset="lamanify_unsigned" 
        id="upload-widget"
        options={{
            sources: ['local', 'url', 'unsplash'],
            multiple: false,
            maxFiles: 1
        }}
      >
        <button class="w-full bg-brand hover:bg-brand-dark text-white font-medium px-6 py-3 rounded-xl transition-colors shadow-lg shadow-brand/20 flex items-center justify-center gap-2">
          <span>Click to Upload</span>
        </button>
      </CldUploadWidget>

      <div id="result" class="mt-6 p-4 rounded-lg bg-green-50 border border-green-200 text-green-700 text-sm hidden break-all">
          <p class="font-bold mb-1">Upload Successful!</p>
          <code id="public-id" class="block bg-white p-2 rounded border border-green-200 mt-2"></code>
      </div>
    </div>
  </main>

  <script>
    const widget = document.querySelector('#upload-widget');
    const resultDiv = document.getElementById('result');
    const publicIdCode = document.getElementById('public-id');

    if (widget) {
      widget.addEventListener('clduploadwidget:success', ((e: CustomEvent) => {
        // 1. Get the Public ID from Cloudinary
        const publicId = e.detail.info.public_id;
        console.log('Upload success:', publicId);

        // 2. Show it to the user
        if (resultDiv && publicIdCode) {
            publicIdCode.innerText = publicId;
            resultDiv.classList.remove('hidden');
        }

        // 3. Optional: Send to Supabase
      }) as EventListener);
    }
  </script>
</Layout>
